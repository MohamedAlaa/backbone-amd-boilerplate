define(["../core","../var/support","../ajax"],function(e,t){e.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var n=0,r={},i={0:200,1223:204},s=e.ajaxSettings.xhr();window.ActiveXObject&&e(window).on("unload",function(){for(var e in r)r[e]()}),t.cors=!!s&&"withCredentials"in s,t.ajax=s=!!s,e.ajaxTransport(function(e){var o;if(t.cors||s&&!e.crossDomain)return{send:function(t,s){var u,a=e.xhr(),f=++n;a.open(e.type,e.url,e.async,e.username,e.password);if(e.xhrFields)for(u in e.xhrFields)a[u]=e.xhrFields[u];e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),!e.crossDomain&&!t["X-Requested-With"]&&(t["X-Requested-With"]="XMLHttpRequest");for(u in t)a.setRequestHeader(u,t[u]);o=function(e){return function(){o&&(delete r[f],o=a.onload=a.onerror=null,e==="abort"?a.abort():e==="error"?s(a.status,a.statusText):s(i[a.status]||a.status,a.statusText,typeof a.responseText=="string"?{text:a.responseText}:undefined,a.getAllResponseHeaders()))}},a.onload=o(),a.onerror=o("error"),o=r[f]=o("abort");try{a.send(e.hasContent&&e.data||null)}catch(l){if(o)throw l}},abort:function(){o&&o()}}})});