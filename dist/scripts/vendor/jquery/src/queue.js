define(["./core","./data/var/data_priv","./deferred","./callbacks"],function(e,t){return e.extend({queue:function(n,r,i){var s;if(n)return r=(r||"fx")+"queue",s=t.get(n,r),i&&(!s||e.isArray(i)?s=t.access(n,r,e.makeArray(i)):s.push(i)),s||[]},dequeue:function(t,n){n=n||"fx";var r=e.queue(t,n),i=r.length,s=r.shift(),o=e._queueHooks(t,n),u=function(){e.dequeue(t,n)};s==="inprogress"&&(s=r.shift(),i--),s&&(n==="fx"&&r.unshift("inprogress"),delete o.stop,s.call(t,u,o)),!i&&o&&o.empty.fire()},_queueHooks:function(n,r){var i=r+"queueHooks";return t.get(n,i)||t.access(n,i,{empty:e.Callbacks("once memory").add(function(){t.remove(n,[r+"queue",i])})})}}),e.fn.extend({queue:function(t,n){var r=2;return typeof t!="string"&&(n=t,t="fx",r--),arguments.length<r?e.queue(this[0],t):n===undefined?this:this.each(function(){var r=e.queue(this,t,n);e._queueHooks(this,t),t==="fx"&&r[0]!=="inprogress"&&e.dequeue(this,t)})},dequeue:function(t){return this.each(function(){e.dequeue(this,t)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(n,r){var i,s=1,o=e.Deferred(),u=this,a=this.length,f=function(){--s||o.resolveWith(u,[u])};typeof n!="string"&&(r=n,n=undefined),n=n||"fx";while(a--)i=t.get(u[a],n+"queueHooks"),i&&i.empty&&(s++,i.empty.add(f));return f(),o.promise(r)}}),e});